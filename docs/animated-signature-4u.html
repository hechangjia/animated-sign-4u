<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG ç­¾ååŠ¨ç”»ç”Ÿæˆå™¨ Ultimate Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            user-select: none;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Grid pattern for transparent background indication */
        .bg-grid-pattern {
            background-image: linear-gradient(45deg, #e2e8f0 25%, transparent 25%),
                linear-gradient(-45deg, #e2e8f0 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #e2e8f0 75%),
                linear-gradient(-45deg, transparent 75%, #e2e8f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: white;
        }

        .theme-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        .theme-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .theme-btn.active {
            border-color: #4f46e5;
            transform: scale(1.05);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s;
        }

        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
        }

        .resizer {
            background-color: #e2e8f0;
            height: 8px;
            cursor: row-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            border-top: 1px solid #cbd5e1;
            border-bottom: 1px solid #cbd5e1;
        }

        .resizer:hover,
        .resizer.resizing {
            background-color: #6366f1;
        }

        .resizer span {
            width: 40px;
            height: 4px;
            background-color: #94a3b8;
            border-radius: 2px;
        }

        .resizer:hover span {
            background-color: white;
        }

        /* Improved Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68D391;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #68D391;
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }

        /* Animation for hidden areas */
        .slide-down {
            animation: slideDown 0.3s ease-out forwards;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden bg-slate-50">

    <!-- Header -->
    <header
        class="bg-white border-b border-gray-200 h-16 flex items-center px-6 justify-between flex-shrink-0 z-20 shadow-sm">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg transform -rotate-3">
                S</div>
            <h1 class="text-lg font-bold text-gray-800 tracking-tight hidden md:block">Signature <span
                    class="text-indigo-600">Ultimate</span></h1>
        </div>
        <div class="flex items-center gap-3">
            <div class="relative group">
                <button
                    class="bg-gray-900 hover:bg-gray-800 text-white text-xs font-bold py-2 px-4 rounded-lg shadow transition flex items-center gap-2">
                    <i class="fas fa-code-branch"></i> å¯¼å‡ºç»„ä»¶ <i class="fas fa-chevron-down opacity-50"></i>
                </button>
                <div
                    class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden hidden group-hover:block z-50 transform origin-top-right transition-all">
                    <div class="p-2">
                        <button onclick="exportComponent('react')"
                            class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 rounded-lg transition flex items-center"><i
                                class="fab fa-react w-6"></i> React Component</button>
                        <button onclick="exportComponent('vue')"
                            class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-600 rounded-lg transition flex items-center"><i
                                class="fab fa-vuejs w-6"></i> Vue Component</button>
                        <button onclick="exportComponent('html')"
                            class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-orange-50 hover:text-orange-600 rounded-lg transition flex items-center"><i
                                class="fab fa-html5 w-6"></i> HTML / JS</button>
                    </div>
                </div>
            </div>

            <button onclick="downloadSVG()"
                class="border border-gray-200 bg-white hover:bg-gray-50 text-gray-700 text-xs font-bold py-2 px-4 rounded-lg transition flex items-center gap-2 shadow-sm">
                <i class="fas fa-download text-gray-400"></i> SVG
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">

        <!-- Left Sidebar: Configuration -->
        <aside
            class="w-full md:w-80 lg:w-96 bg-white border-r border-gray-200 overflow-y-auto flex flex-col z-10 scroll-smooth">
            <div class="p-6 space-y-8 pb-20">

                <!-- Section 1: Text & Font -->
                <section>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span
                            class="w-6 h-6 rounded bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px]"><i
                                class="fas fa-pen-nib"></i></span>
                        å†…å®¹ä¸å­—ä½“
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1.5">ç­¾åæ–‡å­—</label>
                            <input type="text" id="inputText" value="yunique"
                                class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-gray-800 font-medium transition-all shadow-sm"
                                placeholder="è¾“å…¥ç­¾åå†…å®¹...">
                        </div>

                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1.5">é€‰æ‹©å­—ä½“</label>
                            <div class="relative">
                                <select id="fontSelect"
                                    class="w-full pl-3 pr-10 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none appearance-none bg-white text-sm shadow-sm cursor-pointer">
                                    <optgroup label="âœ¨ è‹±æ–‡æ‰‹å†™">
                                        <option value="great-vibes">Great Vibes (ä¼˜é›…ç»å…¸)</option>
                                        <option value="dancing-script">Dancing Script (æ´»æ³¼è·³è·ƒ)</option>
                                        <option value="allura">Allura (æç®€è¿ç¬”)</option>
                                        <option value="sacramento">Sacramento (å¤å¤ç»†ä½“)</option>
                                    </optgroup>
                                    <optgroup label="ğŸ”¥ å“ç‰Œé£æ ¼">
                                        <option value="lobster">Lobster (å¯ä¹é£/ç²—ä½“)</option>
                                        <option value="pacifico">Pacifico (å¯çˆ±åœ†æ¶¦)</option>
                                        <option value="permanent-marker">Marker (è¡—å¤´/é›ªç¢§)</option>
                                    </optgroup>
                                    <optgroup label="ğŸ§§ ä¸­æ–‡/æœ¬åœ°">
                                        <option value="ma-shan-zheng">é©¬å–„æ”¿æ¯›ç¬” (ä¸­å›½é£)</option>
                                        <option value="custom">ğŸ“‚ ä¸Šä¼ æœ¬åœ°å­—ä½“...</option>
                                    </optgroup>
                                </select>
                                <div class="absolute right-3 top-3 text-gray-400 pointer-events-none"><i
                                        class="fas fa-chevron-down text-xs"></i></div>
                            </div>
                        </div>

                        <div id="customFontArea"
                            class="hidden p-3 bg-gray-50 border border-dashed border-gray-300 rounded-lg animate-fade-in">
                            <input type="file" id="fontInput" accept=".ttf,.otf,.woff"
                                class="block w-full text-xs text-gray-500 file:mr-2 file:py-1.5 file:px-3 file:rounded-md file:border-0 file:bg-white file:text-indigo-600 file:font-bold file:shadow-sm cursor-pointer">
                        </div>
                        <div id="fontStatus" class="text-xs flex items-center text-gray-400 h-4 transition-all"></div>
                    </div>
                </section>

                <hr class="border-gray-100">

                <!-- Section 2: Styling & Colors -->
                <section>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span
                            class="w-6 h-6 rounded bg-pink-100 text-pink-600 flex items-center justify-center text-[10px]"><i
                                class="fas fa-palette"></i></span>
                        æ ·å¼ä¸è‰²å½©
                    </h3>

                    <!-- Background & Texture -->
                    <div class="mb-5 p-3 bg-white border border-gray-200 rounded-xl shadow-sm">
                        <!-- Bg Color & Transparent Toggle -->
                        <div class="flex justify-between items-center mb-3 h-8">
                            <span class="text-xs font-semibold text-gray-700">å¡ç‰‡èƒŒæ™¯</span>

                            <label class="flex items-center cursor-pointer relative">
                                <input type="checkbox" id="bgTransparent" class="sr-only peer">
                                <div
                                    class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-indigo-600 border border-gray-300 shadow-inner">
                                </div>
                                <span
                                    class="ml-2 text-xs font-medium text-gray-500 peer-checked:text-indigo-600 transition-colors select-none">é€æ˜</span>
                            </label>
                        </div>

                        <div id="bgColorControl" class="flex items-center gap-3 transition-all duration-300 mb-4">
                            <div
                                class="relative w-8 h-8 rounded-full overflow-hidden ring-1 ring-gray-200 shadow-sm hover:scale-105 transition">
                                <input type="color" id="bgColor" value="#ffffff"
                                    class="absolute -top-2 -left-2 w-12 h-12 cursor-pointer p-0">
                            </div>
                            <span class="text-xs text-gray-500 font-mono bg-gray-50 px-2 py-1 rounded"
                                id="bgHex">#ffffff</span>
                        </div>

                        <!-- Texture Controls (New) -->
                        <div class="pt-3 border-t border-gray-100">
                            <label class="block text-xs font-medium text-gray-500 mb-2">èƒŒæ™¯çº¹ç†</label>
                            <select id="textureType"
                                class="w-full text-xs px-2 py-1.5 border border-gray-300 rounded-md focus:ring-1 focus:ring-indigo-500 outline-none bg-gray-50 mb-3">
                                <option value="none">æ— çº¹ç† (None)</option>
                                <option value="grid">æ–¹æ ¼ (Grid)</option>
                                <option value="dots">ç‚¹é˜µ (Dots)</option>
                                <option value="lines">æ¨ªçº¿ (Lines)</option>
                                <option value="cross">åå­— (Cross)</option>
                            </select>

                            <div id="textureParams" class="hidden space-y-3 slide-down pl-1">
                                <div class="flex items-center justify-between">
                                    <span class="text-[10px] text-gray-400">é¢œè‰²</span>
                                    <input type="color" id="textureColor" value="#cbd5e1"
                                        class="w-5 h-5 rounded cursor-pointer border border-gray-200">
                                </div>

                                <div>
                                    <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                                        <span>å¤§å°</span><span id="texSizeVal">20</span></div>
                                    <input type="range" id="textureSize" min="10" max="100" value="20"
                                        class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                </div>

                                <div>
                                    <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                                        <span>ç²—ç»†</span><span id="texThickVal">1</span></div>
                                    <input type="range" id="textureThickness" min="0.5" max="5" step="0.5" value="1"
                                        class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                </div>

                                <div>
                                    <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                                        <span>é€æ˜åº¦</span><span id="texOpacityVal">0.5</span></div>
                                    <input type="range" id="textureOpacity" min="0.1" max="1.0" step="0.1" value="0.5"
                                        class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <!-- Border Radius -->
                        <div class="mt-3 pt-3 border-t border-gray-100">
                            <div class="flex justify-between text-xs mb-1.5">
                                <span class="text-gray-500">åœ†è§’</span>
                                <span id="radiusVal" class="text-indigo-600 font-mono">12px</span>
                            </div>
                            <input type="range" id="borderRadius" min="0" max="40" value="12" class="w-full h-1.5">
                        </div>
                    </div>

                    <!-- Stroke -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1.5">
                            <label class="text-xs font-medium text-gray-500">æè¾¹é¢œè‰² (Stroke)</label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="enableStroke" checked class="sr-only peer">
                                <span class="mr-2 text-[10px] text-gray-400 peer-checked:text-indigo-600">å¯ç”¨</span>
                                <div
                                    class="w-7 h-4 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-indigo-600">
                                </div>
                            </label>
                        </div>

                        <div id="strokeControls" class="flex items-center gap-3 transition-opacity duration-300">
                            <div class="relative w-full h-9 rounded-lg overflow-hidden ring-1 ring-gray-200 shadow-sm">
                                <input type="color" id="strokeColor" value="#333333"
                                    class="absolute -top-2 -left-2 w-[110%] h-[150%] cursor-pointer">
                            </div>
                            <span id="strokeHex" class="text-xs font-mono text-gray-400 w-16">#333333</span>
                        </div>
                    </div>

                    <!-- Fill Configuration -->
                    <div class="mb-4">
                        <label class="block text-xs font-medium text-gray-500 mb-2">æ–‡å­—å¡«å……æ¨¡å¼</label>
                        <div class="flex bg-gray-100 p-1 rounded-lg mb-3">
                            <button
                                class="flex-1 py-1.5 text-xs font-medium rounded-md transition-all fill-mode-btn active bg-white shadow-sm text-gray-800"
                                data-mode="single">å•è‰²</button>
                            <button
                                class="flex-1 py-1.5 text-xs font-medium rounded-md transition-all fill-mode-btn text-gray-500 hover:text-gray-700"
                                data-mode="gradient">æ¸å˜</button>
                            <button
                                class="flex-1 py-1.5 text-xs font-medium rounded-md transition-all fill-mode-btn text-gray-500 hover:text-gray-700"
                                data-mode="multi">é€å­—</button>
                        </div>

                        <div id="fillSingleArea" class="fill-area">
                            <div class="relative w-full h-9 rounded-lg overflow-hidden ring-1 ring-gray-200 shadow-sm">
                                <input type="color" id="fillColor1" value="#333333"
                                    class="absolute -top-2 -left-2 w-[110%] h-[150%] cursor-pointer">
                            </div>
                        </div>

                        <div id="fillGradientArea" class="fill-area hidden">
                            <div class="flex gap-2 items-center">
                                <div
                                    class="relative flex-1 h-9 rounded-lg overflow-hidden ring-1 ring-gray-200 shadow-sm">
                                    <input type="color" id="gradColor1" value="#333333"
                                        class="absolute -top-2 -left-2 w-[120%] h-[150%] cursor-pointer">
                                </div>
                                <span class="text-gray-300"><i class="fas fa-arrow-right"></i></span>
                                <div
                                    class="relative flex-1 h-9 rounded-lg overflow-hidden ring-1 ring-gray-200 shadow-sm">
                                    <input type="color" id="gradColor2" value="#ec4899"
                                        class="absolute -top-2 -left-2 w-[120%] h-[150%] cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <div id="fillMultiArea" class="fill-area hidden">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-2 overflow-x-auto">
                                <div id="charColorContainer" class="flex gap-2 min-w-max pb-1"></div>
                            </div>
                            <p class="text-[10px] text-gray-400 mt-1 text-right">ä¸ºæ¯ä¸ªå­—ç¬¦å•ç‹¬é…è‰²</p>
                        </div>
                    </div>

                    <!-- Effects -->
                    <div class="grid grid-cols-2 gap-3">
                        <label
                            class="cursor-pointer bg-white border border-gray-200 p-3 rounded-xl hover:border-indigo-300 hover:shadow-md transition group">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-xs font-bold text-gray-700">Glow</span>
                                <input type="checkbox" id="useGlow"
                                    class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                            </div>
                            <p class="text-[10px] text-gray-400 group-hover:text-indigo-400">éœ“è™¹å‘å…‰æ»¤é•œ</p>
                        </label>

                        <label
                            class="cursor-pointer bg-white border border-gray-200 p-3 rounded-xl hover:border-indigo-300 hover:shadow-md transition group">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-xs font-bold text-gray-700">Shadow</span>
                                <input type="checkbox" id="useShadow"
                                    class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                            </div>
                            <p class="text-[10px] text-gray-400 group-hover:text-indigo-400">ç«‹ä½“æŠ•å½±æ•ˆæœ</p>
                        </label>
                    </div>
                </section>

                <!-- Section 3: Themes -->
                <section>
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                        <span
                            class="w-6 h-6 rounded bg-amber-100 text-amber-600 flex items-center justify-center text-[10px]"><i
                                class="fas fa-magic"></i></span>
                        ä¸€é”®ä¸»é¢˜
                    </h3>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="applyTheme('default')"
                            class="theme-btn active bg-gray-100 text-gray-600 h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1">
                            <div class="w-3 h-3 bg-gray-800 rounded-full"></div> Default
                        </button>
                        <button onclick="applyTheme('school')"
                            class="theme-btn bg-white text-blue-600 h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1 border border-gray-200">
                            <!-- Paper texture hint -->
                            <div class="w-3 h-3 bg-blue-600 rounded-full opacity-50"
                                style="background-image: linear-gradient(#fff 1px, transparent 1px); background-size: 2px 2px;">
                            </div> Paper
                        </button>
                        <button onclick="applyTheme('coke')"
                            class="theme-btn bg-red-600 text-white h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1">
                            <div class="w-3 h-3 bg-white rounded-full"></div> Cola
                        </button>
                        <button onclick="applyTheme('blueprint')"
                            class="theme-btn bg-blue-900 text-white h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1 border border-blue-700">
                            <div class="w-3 h-3 border border-white rounded-sm"></div> Plan
                        </button>
                        <button onclick="applyTheme('sprite')"
                            class="theme-btn bg-green-600 text-yellow-300 h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1">
                            <div class="w-3 h-3 bg-yellow-300 rounded-full border border-green-800"></div> Sprite
                        </button>
                        <button onclick="applyTheme('cyber')"
                            class="theme-btn bg-slate-900 text-pink-500 h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1 border border-yellow-400">
                            <div class="w-3 h-3 bg-yellow-400 rounded-sm"></div> Cyber
                        </button>
                        <button onclick="applyTheme('chinese')"
                            class="theme-btn bg-red-50 text-red-800 h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1 border border-red-200">
                            <div class="w-3 h-3 bg-red-800 rounded-full"></div> China
                        </button>
                        <button onclick="applyTheme('rainbow')"
                            class="theme-btn bg-white text-indigo-600 h-14 rounded-lg text-[10px] font-bold flex flex-col items-center justify-center gap-1 border border-gray-200">
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-red-500 via-green-500 to-blue-500">
                            </div> Color
                        </button>
                    </div>
                </section>

                <!-- Section 4: Params -->
                <section>
                    <div class="space-y-5">
                        <div>
                            <div class="flex justify-between text-xs mb-1.5 text-gray-500 font-medium">
                                <span>å­—ä½“å¤§å°</span><span id="fontSizeVal" class="text-indigo-600 font-mono">120px</span>
                            </div>
                            <input type="range" id="fontSize" min="40" max="200" value="120" class="w-full h-1.5">
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1.5 text-gray-500 font-medium">
                                <span>ä¹¦å†™é€Ÿåº¦</span><span id="speedVal" class="text-indigo-600 font-mono">0.4s/å­—</span>
                            </div>
                            <input type="range" id="animSpeed" min="0.1" max="1.5" step="0.1" value="0.4"
                                class="w-full h-1.5">
                        </div>
                    </div>
                </section>
            </div>
        </aside>

        <!-- Right Main -->
        <main class="flex-1 flex flex-col bg-gray-100 relative h-full">
            <div id="previewArea"
                class="flex-grow min-h-[200px] flex flex-col relative transition-colors duration-500 overflow-hidden">
                <div class="flex-1 flex items-center justify-center p-10 overflow-auto relative z-0" id="mainPreviewBg">
                    <div id="previewWrapper"
                        class="relative shadow-2xl transition-all duration-300 group cursor-pointer bg-white select-none flex items-center justify-center"
                        onclick="replayAnimation()" style="border-radius: 12px;">
                        <div id="previewContainer" class="p-10 min-w-[200px] min-h-[100px]">
                            <div class="text-gray-400 text-sm flex flex-col items-center animate-pulse">
                                <i class="fas fa-circle-notch fa-spin text-2xl mb-2 text-indigo-500"></i>
                                æ­£åœ¨åˆå§‹åŒ–èµ„æº...
                            </div>
                        </div>
                        <div class="absolute -bottom-8 left-0 w-full text-center">
                            <span
                                class="text-[10px] text-gray-400 bg-white/80 px-2 py-1 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">ç‚¹å‡»é‡æ’­åŠ¨ç”»</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="resizer" id="dragHandle"><span></span></div>
            <div id="codePanel" class="bg-slate-900 flex flex-col shadow-inner z-20"
                style="height: 250px; min-height: 100px; max-height: 80vh;">
                <div
                    class="flex items-center justify-between px-4 py-2 bg-slate-800 border-b border-slate-700 shrink-0">
                    <div class="flex items-center gap-2">
                        <span
                            class="text-[10px] font-bold text-indigo-400 uppercase tracking-wider bg-indigo-900/30 px-2 py-0.5 rounded"
                            id="codeTitle">SVG Code</span>
                        <span class="text-[10px] text-gray-500">Read-only</span>
                    </div>
                    <button onclick="copyCode()"
                        class="text-xs text-gray-400 hover:text-white transition flex items-center gap-1 px-2 py-1 hover:bg-slate-700 rounded"><i
                            class="far fa-copy"></i> å¤åˆ¶</button>
                </div>
                <div class="flex-1 relative overflow-hidden group">
                    <textarea id="outputCode"
                        class="absolute inset-0 w-full h-full p-4 bg-slate-900 text-green-400 font-mono text-xs focus:outline-none resize-none leading-relaxed"
                        readonly spellcheck="false"></textarea>
                </div>
            </div>
        </main>
    </div>

    <svg id="measureSvg" style="position: absolute; top: -9999px; visibility: hidden;"></svg>

    <script>
        // --- Config ---
        const fontMap = {
            'great-vibes': 'https://cdn.jsdelivr.net/npm/@fontsource/great-vibes@5.0.8/files/great-vibes-latin-400-normal.woff',
            'dancing-script': 'https://cdn.jsdelivr.net/npm/@fontsource/dancing-script@5.0.8/files/dancing-script-latin-400-normal.woff',
            'sacramento': 'https://cdn.jsdelivr.net/npm/@fontsource/sacramento@5.0.8/files/sacramento-latin-400-normal.woff',
            'allura': 'https://cdn.jsdelivr.net/npm/@fontsource/allura@5.0.20/files/allura-latin-400-normal.woff',
            'lobster': 'https://cdn.jsdelivr.net/npm/@fontsource/lobster@5.0.8/files/lobster-latin-400-normal.woff',
            'pacifico': 'https://cdn.jsdelivr.net/npm/@fontsource/pacifico@5.0.8/files/pacifico-latin-400-normal.woff',
            'permanent-marker': 'https://cdn.jsdelivr.net/npm/@fontsource/permanent-marker@5.0.8/files/permanent-marker-latin-400-normal.woff',
            'ma-shan-zheng': 'https://cdn.jsdelivr.net/npm/@fontsource/ma-shan-zheng@5.0.13/files/ma-shan-zheng-latin-400-normal.woff'
        };

        const themes = {
            'default': { bg: '#ffffff', transparent: false, stroke: '#333333', strokeEnabled: true, fillMode: 'single', fill1: '#333333', font: 'great-vibes', glow: false, shadow: false, radius: 12, texture: 'none' },
            'school': { bg: '#ffffff', transparent: false, stroke: '#1e3a8a', strokeEnabled: true, fillMode: 'single', fill1: '#1d4ed8', font: 'dancing-script', glow: false, shadow: false, radius: 4, texture: 'lines', texColor: '#e2e8f0', texSize: 25, texThick: 1 },
            'blueprint': { bg: '#1e3a8a', transparent: false, stroke: '#ffffff', strokeEnabled: true, fillMode: 'single', fill1: '#ffffff', font: 'sacramento', glow: false, shadow: false, radius: 0, texture: 'grid', texColor: '#ffffff', texOpacity: 0.2, texSize: 30 },
            'laser': { bg: '#000000', transparent: false, stroke: '#00ffff', strokeEnabled: true, fillMode: 'gradient', fill1: '#00ffff', fill2: '#ff00ff', font: 'sacramento', glow: true, shadow: true, radius: 0, texture: 'grid', texColor: '#333333' },
            'coke': { bg: '#f40009', transparent: false, stroke: '#ffffff', strokeEnabled: true, fillMode: 'single', fill1: '#ffffff', font: 'lobster', glow: false, shadow: true, radius: 20, texture: 'none' },
            'sprite': { bg: '#008b47', transparent: false, stroke: '#f8cd2b', strokeEnabled: true, fillMode: 'single', fill1: '#f8cd2b', font: 'permanent-marker', glow: false, shadow: true, radius: 8, texture: 'dots', texColor: '#ffffff', texOpacity: 0.2, texSize: 10 },
            'cyber': { bg: '#0f172a', transparent: false, stroke: '#facc15', strokeEnabled: true, fillMode: 'gradient', fill1: '#facc15', fill2: '#d946ef', font: 'pacifico', glow: true, shadow: true, radius: 4, texture: 'cross', texColor: '#334155', texSize: 40 },
            'chinese': { bg: '#fff1f2', transparent: false, stroke: '#7f1d1d', strokeEnabled: true, fillMode: 'single', fill1: '#991b1b', font: 'ma-shan-zheng', glow: false, shadow: false, radius: 4, texture: 'none' },
            'rainbow': { bg: '#ffffff', transparent: false, stroke: '#333333', strokeEnabled: true, fillMode: 'multi', fill1: '#333333', font: 'dancing-script', glow: false, shadow: false, radius: 16, isRainbow: true, texture: 'none' }
        };

        // State
        let state = {
            text: 'yunique',
            font: 'great-vibes',
            fontSize: 120,
            speed: 0.4,
            bg: '#ffffff',
            bgTransparent: false,
            borderRadius: 12,

            stroke: '#333333',
            strokeEnabled: true,

            fillMode: 'single',
            fill1: '#333333',
            fill2: '#ec4899',
            charColors: [],

            texture: 'none', // none, grid, dots, lines, cross
            texColor: '#cbd5e1',
            texSize: 20,
            texThickness: 1,
            texOpacity: 0.5,

            useGlow: false,
            useShadow: false
        };

        let currentFontObj = null;
        let debounceTimer = null;
        let defaultCharColors = ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981', '#06b6d4', '#3b82f6', '#8b5cf6', '#d946ef'];

        window.onload = () => {
            initResizer();
            initCharColors();
            loadFont(fontMap['great-vibes']);
            bindEvents();
            updateUI();
        };

        function initResizer() {
            const handle = document.getElementById('dragHandle');
            const panel = document.getElementById('codePanel');
            let isResizing = false;
            let lastY = 0;
            handle.addEventListener('mousedown', (e) => { isResizing = true; lastY = e.clientY; handle.classList.add('resizing'); document.body.style.cursor = 'row-resize'; });
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const delta = lastY - e.clientY; lastY = e.clientY;
                const newHeight = panel.offsetHeight + delta;
                if (newHeight > 50 && newHeight < window.innerHeight - 150) panel.style.height = `${newHeight}px`;
            });
            document.addEventListener('mouseup', () => { isResizing = false; handle.classList.remove('resizing'); document.body.style.cursor = ''; });
        }

        function bindEvents() {
            const inputs = {
                'inputText': 'text', 'bgColor': 'bg', 'strokeColor': 'stroke', 'fillColor1': 'fill1',
                'gradColor1': 'fill1', 'gradColor2': 'fill2', 'fontSize': 'fontSize', 'animSpeed': 'speed',
                'borderRadius': 'borderRadius', 'textureColor': 'texColor', 'textureSize': 'texSize',
                'textureThickness': 'texThickness', 'textureOpacity': 'texOpacity'
            };

            // Generic Inputs
            for (const [id, key] of Object.entries(inputs)) {
                document.getElementById(id).addEventListener('input', (e) => {
                    state[key] = e.target.value;
                    if (id === 'inputText') { updateCharColorsUI(); initCharColors(); }
                    if (id.includes('texture')) updateUI(); // Update labels immediately
                    debouncedGenerate();
                    if (id.includes('texture') || id === 'bgColor' || id === 'borderRadius') updateUI();
                });
            }

            // Toggles & Selects
            document.getElementById('bgTransparent').addEventListener('change', (e) => { state.bgTransparent = e.target.checked; updateUI(); debouncedGenerate(); });
            document.getElementById('enableStroke').addEventListener('change', (e) => { state.strokeEnabled = e.target.checked; updateUI(); debouncedGenerate(); });
            document.getElementById('useGlow').addEventListener('change', (e) => { state.useGlow = e.target.checked; debouncedGenerate(); });
            document.getElementById('useShadow').addEventListener('change', (e) => { state.useShadow = e.target.checked; debouncedGenerate(); });

            document.getElementById('textureType').addEventListener('change', (e) => {
                state.texture = e.target.value;
                updateUI();
                debouncedGenerate();
            });

            document.getElementById('fontSelect').addEventListener('change', (e) => {
                if (e.target.value === 'custom') document.getElementById('customFontArea').classList.remove('hidden');
                else { document.getElementById('customFontArea').classList.add('hidden'); state.font = e.target.value; loadFont(fontMap[state.font]); }
            });

            document.querySelectorAll('.fill-mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    state.fillMode = e.target.dataset.mode;
                    updateUI(); debouncedGenerate();
                });
            });

            document.getElementById('fontInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => { try { currentFontObj = opentype.parse(ev.target.result); generateSignature(); } catch (err) { alert("Font Error"); } }
                    reader.readAsArrayBuffer(file);
                }
            });
        }

        function initCharColors() {
            if (state.charColors.length < state.text.length) {
                const diff = state.text.length - state.charColors.length;
                for (let i = 0; i < diff; i++) state.charColors.push(state.fill1);
            }
        }

        function updateCharColorsUI() {
            const container = document.getElementById('charColorContainer');
            container.innerHTML = '';
            state.text.split('').forEach((char, idx) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'flex flex-col items-center min-w-[24px] gap-1';
                const input = document.createElement('input');
                input.type = 'color';
                input.value = state.charColors[idx] || state.fill1;
                input.className = "w-6 h-6 rounded cursor-pointer border-none";
                input.addEventListener('input', (e) => { state.charColors[idx] = e.target.value; debouncedGenerate(); });
                wrapper.innerHTML = `<span class="text-[10px] text-gray-500 font-mono">${char}</span>`;
                wrapper.appendChild(input);
                container.appendChild(wrapper);
            });
        }

        function updateUI() {
            // Labels
            document.getElementById('bgHex').innerText = state.bg;
            document.getElementById('strokeHex').innerText = state.stroke;
            document.getElementById('fontSizeVal').innerText = state.fontSize + 'px';
            document.getElementById('speedVal').innerText = state.speed + 's';
            document.getElementById('radiusVal').innerText = state.borderRadius + 'px';

            document.getElementById('texSizeVal').innerText = state.texSize;
            document.getElementById('texThickVal').innerText = state.texThickness;
            document.getElementById('texOpacityVal').innerText = state.texOpacity;

            // Visibility Logic
            document.getElementById('bgColorControl').style.opacity = state.bgTransparent ? '0.3' : '1';
            document.getElementById('strokeControls').style.opacity = state.strokeEnabled ? '1' : '0.3';

            // Texture UI
            if (state.texture === 'none') {
                document.getElementById('textureParams').classList.add('hidden');
            } else {
                document.getElementById('textureParams').classList.remove('hidden');
                // Trigger animation reflow
                document.getElementById('textureParams').classList.remove('slide-down');
                void document.getElementById('textureParams').offsetWidth;
                document.getElementById('textureParams').classList.add('slide-down');
            }

            // Fill Mode UI
            document.querySelectorAll('.fill-mode-btn').forEach(btn => {
                if (btn.dataset.mode === state.fillMode) {
                    btn.classList.add('bg-white', 'shadow-sm', 'text-gray-800');
                    btn.classList.remove('text-gray-500');
                } else {
                    btn.classList.remove('bg-white', 'shadow-sm', 'text-gray-800');
                    btn.classList.add('text-gray-500');
                }
            });
            ['single', 'gradient', 'multi'].forEach(m => document.getElementById(`fill${m.charAt(0).toUpperCase() + m.slice(1)}Area`).classList.add('hidden'));
            document.getElementById(`fill${state.fillMode.charAt(0).toUpperCase() + state.fillMode.slice(1)}Area`).classList.remove('hidden');
            if (state.fillMode === 'multi') updateCharColorsUI();

            // Sync Inputs
            document.getElementById('bgTransparent').checked = state.bgTransparent;
            document.getElementById('enableStroke').checked = state.strokeEnabled;
            document.getElementById('useGlow').checked = state.useGlow;
            document.getElementById('useShadow').checked = state.useShadow;
            document.getElementById('bgColor').value = state.bg;
            document.getElementById('textureType').value = state.texture;
            document.getElementById('textureColor').value = state.texColor;

            // Preview Bg
            const wrapper = document.getElementById('previewWrapper');
            const mainBg = document.getElementById('mainPreviewBg');

            if (state.bgTransparent) {
                wrapper.style.backgroundColor = 'transparent';
                mainBg.classList.add('bg-grid-pattern');
                wrapper.style.boxShadow = 'none';
            } else {
                wrapper.style.backgroundColor = state.bg;
                mainBg.classList.remove('bg-grid-pattern');
                wrapper.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.25)';
            }
            wrapper.style.borderRadius = `${state.borderRadius}px`;
        }

        function applyTheme(name) {
            const t = themes[name];
            Object.keys(t).forEach(k => state[k] = t[k]);
            if (t.isRainbow) {
                const len = state.text.length;
                state.charColors = Array.from({ length: len }, (_, i) => defaultCharColors[i % defaultCharColors.length]);
            }
            if (state.font !== document.getElementById('fontSelect').value) {
                document.getElementById('fontSelect').value = state.font;
                loadFont(fontMap[state.font]);
            }
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            updateUI(); debouncedGenerate();
        }

        function loadFont(url) {
            document.getElementById('fontStatus').innerText = "ä¸‹è½½å­—ä½“ä¸­...";
            opentype.load(url, (err, font) => {
                if (err) return document.getElementById('fontStatus').innerText = "å¤±è´¥";
                currentFontObj = font;
                document.getElementById('fontStatus').innerText = "";
                generateSignature();
            });
        }

        function debouncedGenerate() { clearTimeout(debounceTimer); debounceTimer = setTimeout(generateSignature, 50); }

        function generateSignature() {
            if (!currentFontObj) return;

            const glyphs = currentFontObj.stringToGlyphs(state.text || 'Demo');
            let paths = [];
            let cursorX = 10;
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            const measureSvg = document.getElementById('measureSvg');
            measureSvg.innerHTML = '';

            glyphs.forEach((glyph, idx) => {
                const path = glyph.getPath(cursorX, 150, parseInt(state.fontSize));
                const d = path.toPathData(2);
                if (d) {
                    const el = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    el.setAttribute("d", d);
                    measureSvg.appendChild(el);
                    const len = Math.ceil(el.getTotalLength());
                    const bbox = path.getBoundingBox();
                    minX = Math.min(minX, bbox.x1); minY = Math.min(minY, bbox.y1);
                    maxX = Math.max(maxX, bbox.x2); maxY = Math.max(maxY, bbox.y2);
                    paths.push({ d, len, index: idx });
                }
                cursorX += glyph.advanceWidth * (parseInt(state.fontSize) / currentFontObj.unitsPerEm);
            });

            if (paths.length === 0) return;

            const p = 40;
            const vbX = minX - p; const vbY = minY - p;
            const vbW = (maxX - minX) + (p * 2); const vbH = (maxY - minY) + (p * 2);
            const viewBox = `${vbX} ${vbY} ${vbW} ${vbH}`;

            let defs = '<defs>';
            let filterRefs = [];

            // 1. Texture Pattern
            if (state.texture !== 'none') {
                const s = state.texSize;
                const c = state.texColor;
                const t = state.texThickness;
                const op = state.texOpacity;

                defs += `<pattern id="bgPattern" x="0" y="0" width="${s}" height="${s}" patternUnits="userSpaceOnUse" patternTransform="rotate(0)">`;

                if (state.texture === 'grid') {
                    defs += `<path d="M ${s} 0 L 0 0 0 ${s}" fill="none" stroke="${c}" stroke-width="${t}" stroke-opacity="${op}"/>`;
                } else if (state.texture === 'dots') {
                    defs += `<circle cx="${s / 2}" cy="${s / 2}" r="${t * 1.5}" fill="${c}" fill-opacity="${op}"/>`;
                } else if (state.texture === 'lines') {
                    defs += `<line x1="0" y1="${s / 2}" x2="${s}" y2="${s / 2}" stroke="${c}" stroke-width="${t}" stroke-opacity="${op}" />`;
                } else if (state.texture === 'cross') {
                    defs += `<path d="M${s / 4},${s / 4} L${s * 0.75},${s * 0.75} M${s * 0.75},${s / 4} L${s / 4},${s * 0.75}" stroke="${c}" stroke-width="${t}" stroke-opacity="${op}" stroke-linecap="round" />`;
                }
                defs += `</pattern>`;
            }

            // 2. Gradient
            if (state.fillMode === 'gradient') {
                defs += `<linearGradient id="sigGrad"><stop offset="0%" stop-color="${state.fill1}"/><stop offset="100%" stop-color="${state.fill2}"/></linearGradient>`;
            }

            // 3. Filters
            if (state.useGlow) defs += `<filter id="glow"><feGaussianBlur stdDeviation="3.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>`;
            if (state.useShadow) defs += `<filter id="shadow"><feDropShadow dx="4" dy="4" stdDeviation="3" flood-opacity="0.6"/></filter>`;

            if (state.useGlow) filterRefs.push('url(#glow)');
            if (state.useShadow) filterRefs.push('url(#shadow)');
            defs += '</defs>';

            // Paths
            let pathsXml = '';
            let currentDelay = 0;
            const speed = parseFloat(state.speed);

            paths.forEach(item => {
                let fillStyle = state.fillMode === 'single' ? state.fill1 : (state.fillMode === 'gradient' ? 'url(#sigGrad)' : (state.charColors[item.index] || state.fill1));

                pathsXml += `    <path d="${item.d}" class="sig-letter" style="stroke-dasharray: ${item.len}; stroke-dashoffset: ${item.len}; animation-delay: ${currentDelay.toFixed(2)}s; fill: ${fillStyle};" />\n`;
                currentDelay += speed * 0.7;
            });

            // Background Rect for Texture
            let bgRect = '';
            if (state.texture !== 'none') {
                bgRect = `<rect x="${vbX}" y="${vbY}" width="${vbW}" height="${vbH}" fill="url(#bgPattern)" />`;
            }
            // Important: If texture is used, we need a base color rect BEHIND it if transparent is off
            if (!state.bgTransparent && state.texture !== 'none') {
                bgRect = `<rect x="${vbX}" y="${vbY}" width="${vbW}" height="${vbH}" fill="${state.bg}" />` + bgRect;
            }

            const filterAttr = filterRefs.length > 0 ? `filter="${filterRefs.join(' ')}"` : '';
            const bgStyle = (state.bgTransparent || state.texture !== 'none') ? '' : `background-color: ${state.bg};`;
            const strokeAttr = state.strokeEnabled ? `stroke: ${state.stroke}; stroke-width: 3px;` : `stroke: none; stroke-width: 0;`;

            const svg = `<!-- Generated by Signature Ultimate -->
<svg viewBox="${viewBox}" width="${Math.min(600, vbW)}" xmlns="http://www.w3.org/2000/svg" style="${bgStyle}border-radius:${state.borderRadius}px;">
  ${defs}
  ${bgRect}
  <style>
    .sig-letter {
      fill-opacity: 0;
      ${strokeAttr}
      stroke-linecap: round;
      stroke-linejoin: round;
      animation: sig-draw ${speed * 2}s cubic-bezier(0.25, 0.1, 0.25, 1) forwards,
                 sig-fill 0.6s ease-out forwards;
      animation-delay: var(--delay), ${(currentDelay + speed * 0.2).toFixed(2)}s;
    }
    @keyframes sig-draw { to { stroke-dashoffset: 0; } }
    @keyframes sig-fill { to { fill-opacity: 1; } }
  </style>
  <g ${filterAttr}>
${pathsXml.replace(/animation-delay: ([\d\.]+)s;/g, 'animation-delay: $1s; --delay: $1s;')}
  </g>
</svg>`;

            document.getElementById('previewContainer').innerHTML = svg;
            document.getElementById('outputCode').value = svg;
            // Apply texture via css to wrapper if transparent (for visual consistency in preview)
            // Note: The SVG itself now contains the texture via <rect>, so it renders correctly inside.
        }

        function copyCode() { document.getElementById('outputCode').select(); document.execCommand('copy'); }
        function downloadSVG() {
            const blob = new Blob([document.getElementById('outputCode').value], { type: "image/svg+xml;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `signature_${state.text}.svg`; document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }
        function replayAnimation() { const c = document.getElementById('previewContainer'); const h = c.innerHTML; c.innerHTML = ''; void c.offsetWidth; c.innerHTML = h; }
        function exportComponent(type) {
            const svg = document.getElementById('outputCode').value;
            if (!svg) return;

            // Clean SVG for component
            // Remove inline background-color and border-radius from SVG root if we are wrapping it
            let cleanSvg = svg.replace(/<svg([^>]*)style="[^"]*"([^>]*)>/, '<svg$1$2>');
            // Note: if texture is active, the background is inside the SVG as <rect>, so background-color: transparent is fine for wrapper.

            const bgVal = (state.bgTransparent) ? 'transparent' : state.bg;
            // If texture is internal, we don't need external background color IF transparent is false, 
            // but usually for components we keep the wrapper style simple.

            let res = '';
            if (type === 'react') {
                let jsx = cleanSvg.replace(/class="/g, 'className="').replace(/-([a-z])/g, (g) => g[1].toUpperCase()).replace(/style="([^"]*)"/g, "style={{$1}}");
                res = `export default function Signature() {\n  return (\n    <div style={{display:'inline-block', padding:'20px', backgroundColor:'${bgVal}', borderRadius:'${state.borderRadius}px'}}>\n      ${jsx}\n    </div>\n  );\n}`;
            } else if (type === 'vue') {
                res = `<template>\n  <div class="sig-card">\n    ${cleanSvg}\n  </div>\n</template>\n<style scoped>\n.sig-card { display: inline-block; padding: 20px; background-color: ${bgVal}; border-radius: ${state.borderRadius}px; }\n</style>`;
            } else {
                res = `<div style="display:inline-block; padding:20px; background-color:${bgVal}; border-radius:${state.borderRadius}px;">\n${cleanSvg}\n</div>`;
            }
            document.getElementById('outputCode').value = res;
            document.getElementById('codeTitle').innerText = type.toUpperCase() + " COMPONENT";
        }
    </script>
</body>

</html>